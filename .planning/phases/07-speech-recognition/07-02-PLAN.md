# Phase 7 Plan 02: Fuzzy Matching & UI Integration

## Objective
Add fuzzy phrase matching and integrate speech recognition into the game UI.

## Context
@Buzzword Bingo/Buzzword Bingo/Models/BingoCard.swift
@Buzzword Bingo/Buzzword Bingo/Services/SpeechRecognitionService.swift
@Buzzword Bingo/Buzzword Bingo/ContentView.swift
@Buzzword Bingo/Buzzword Bingo/Models/GameSession.swift

## Tasks

### Task 1: Create FuzzyMatcher Utility
**Type:** create
**Files:** `Buzzword Bingo/Buzzword Bingo/Services/FuzzyMatcher.swift`
**Action:**
- Create `FuzzyMatcher` struct
- Implement Levenshtein distance algorithm
- Method: `matches(phrase: String, against buzzword: String, threshold: Double = 0.7) -> Bool`
- Normalize both strings (lowercase, remove punctuation)
- Match if similarity score >= threshold
- Handle partial matches (e.g., "let's circle back" matches "circle back")
- Handle semantic equivalents if practical (e.g., "synergy" matches "synergize")

**Verify:** Fuzzy matching works with test cases

### Task 2: Add Speech-Triggered Marking to BingoCard
**Type:** modify
**Files:** `Buzzword Bingo/Buzzword Bingo/Models/BingoCard.swift`
**Action:**
- Add method: `markMatchingSquare(forPhrase phrase: String) -> Bool`
- Use FuzzyMatcher to find best matching unmarked square
- Mark it if found, return true
- Return false if no match
- Only match unmarked squares

**Verify:** Phrases correctly match and mark squares

### Task 3: Add Listening Toggle to GameSession
**Type:** modify
**Files:** `Buzzword Bingo/Buzzword Bingo/Models/GameSession.swift`
**Action:**
- Add `speechService: SpeechRecognitionService?` property
- Add `isListening: Bool` computed from service
- Add `startListening()` and `stopListening()` methods
- Wire up `onPhraseRecognized` to call `markMatchingSquare` on current player's card

**Verify:** GameSession controls listening state

### Task 4: Add Listening UI to ContentView
**Type:** modify
**Files:** `Buzzword Bingo/Buzzword Bingo/ContentView.swift`
**Action:**
- Add microphone toggle button during gameplay
- Show listening indicator (pulsing mic icon) when active
- Request permissions on first tap
- Show permission denied state if not authorized
- Display last recognized phrase for feedback (small text below grid)
- Auto-flash the square that gets marked via speech

**Verify:** UI shows listening state and provides feedback

### Task 5: Accessibility for Speech Feature
**Type:** modify
**Files:** Various
**Action:**
- Add VoiceOver labels to listening toggle
- Announce when square is auto-marked via speech
- Respect reduced motion for listening indicator animation

**Verify:** Speech feature is accessible

### Task 6: Build & Full Test
**Type:** verify
**Action:** Build both platforms, test speech recognition end-to-end
**Verify:** Complete flow works

---

**checkpoint:human-verify**
Test speech recognition:
1. Start a game with 2 players
2. Tap the microphone icon to start listening
3. Say a buzzword from the card (e.g., "Let's circle back on that")
4. Square should auto-mark with visual feedback
5. Recognized phrase should display briefly
6. Stop listening with toggle
7. Test permissions flow on fresh device if possible

Type "approved" if speech recognition works, or describe issues.

---

## Verification
- [ ] Fuzzy matching correctly identifies buzzwords
- [ ] Squares auto-mark on speech detection
- [ ] UI shows listening state
- [ ] Recognized phrases shown for feedback
- [ ] Accessible with VoiceOver
- [ ] Both platforms build

## Success Criteria
- Users can play hands-free during meetings
- Fuzzy matching catches natural variations
- Visual feedback confirms auto-marks
- Clean permission flow

## Output
Create `07-02-SUMMARY.md` documenting speech integration.
